---

apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: erxes-api
spec:
  template:
    spec:
      containers:
      - name: erxes-api
        envFrom:
        - secretRef:
            name: erxes-common-env
        - configMapRef:
            name: erxes-common-env
        - configMapRef:
            name: erxes-api-env
        env:
        # user/pass for the *erxes* database, which is set in custom init script
        # (not root user for admin database, which is set by kubedb secret, but we want erxes-api to use a diff database than mongo's "admin")
        - name: MONGO_URL
          value: mongodb://erxes-api:erxes-api@$(MONGO_HOST)/erxes

---

apiVersion: batch/v1
kind: Job
metadata:
  name: erxes-api-init
spec:
  template:
    spec:
      containers:
      - name: erxes-api-yarn-init
        env:
        - name: MONGO_URL
          value: mongodb://erxes-api:erxes-api@$(MONGO_HOST)/erxes
